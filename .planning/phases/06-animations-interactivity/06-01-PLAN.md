---
phase: 06-animations-interactivity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [index.html]
autonomous: false

must_haves:
  truths:
    - "Content sections fade in with translateY animation as user scrolls into viewport"
    - "Navbar transitions from transparent to opaque background with blur as user scrolls past hero"
    - "Active section is highlighted in navbar based on current scroll position"
    - "All animations respect prefers-reduced-motion media query"
    - "Single shared Intersection Observer manages all scroll animations without memory leaks"
  artifacts:
    - path: "index.html"
      provides: "Scroll animation system with Intersection Observer"
      contains: "IntersectionObserver"
      min_lines: 3000
    - path: "index.html"
      provides: "Navbar scroll transition styles and JavaScript"
      contains: "navbar-scrolled"
    - path: "index.html"
      provides: "Active section highlighting in navbar"
      contains: "nav-link-active"
  key_links:
    - from: "IntersectionObserver instance"
      to: "section elements with .animate-on-scroll class"
      via: "observer.observe() calls"
      pattern: "observer\\.observe\\("
    - from: "scroll event listener"
      to: "navbar background state"
      via: "classList.toggle on scroll position check"
      pattern: "addEventListener\\('scroll'"
    - from: "scroll position calculation"
      to: "navbar active link highlighting"
      via: "comparing section offsets to scroll position"
      pattern: "offsetTop|getBoundingClientRect"
---

<objective>
Implement scroll-triggered animations using single shared Intersection Observer and navbar scroll behavior (transparent to opaque transitions, active section highlighting).

Purpose: Elevate user experience with smooth, performant animations that guide attention and provide visual feedback without sacrificing mobile performance or accessibility.

Output: Fully animated scroll experience with professional polish, respecting prefers-reduced-motion and maintaining 60 FPS on desktop, 30+ FPS on mobile.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/research/PITFALLS.md

Phase Context:
- Single HTML file architecture (all CSS and JS inline)
- Vanilla JavaScript only (no frameworks)
- Dark mode design with network/constellation motif
- Mobile-first responsive design (breakpoints: 768px, 1024px, 1440px)
- Performance target: Lighthouse > 90, load < 2s on 4G
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement shared Intersection Observer for scroll-triggered animations</name>
  <files>index.html</files>
  <action>
Add CSS animation classes and JavaScript Intersection Observer system to index.html:

**CSS (in existing `<style>` tag):**
1. Create `.animate-on-scroll` utility class with initial state: opacity 0, transform translateY(20px)
2. Create `.animated` class for triggered state: opacity 1, transform translateY(0), transition 600ms ease-out
3. Create stagger animation classes `.stagger-1`, `.stagger-2`, `.stagger-3` with increasing transition-delay (100ms, 200ms, 300ms)
4. Create `.scale-in` animation for badges/icons: initial scale(0.8), animated scale(1)
5. Add `@media (prefers-reduced-motion: reduce)` rule to disable all animations (remove transitions, set opacity: 1, transform: none immediately)

**JavaScript (in existing `<script>` tag):**
1. Check for prefers-reduced-motion at script load - if true, skip all animation setup
2. Create single shared IntersectionObserver instance with options: threshold 0.15, rootMargin '0px'
3. In callback: when entry.isIntersecting, add 'animated' class to entry.target AND call observer.unobserve(entry.target) to prevent memory leaks
4. Query all elements with `.animate-on-scroll` class and call observer.observe() for each
5. Add visibility change listener to pause/resume observer when page is backgrounded

**Apply animation classes to sections:**
- Add `.animate-on-scroll` to all major section elements (Problem, Vision, Pillars, Timeline, Ecosystem, News, Newsletter)
- Add `.animate-on-scroll .stagger-1`, `.stagger-2`, `.stagger-3` to card grids (constat cards, feature cards, article cards)
- Add `.animate-on-scroll .scale-in` to section badges

**Critical constraints from PITFALLS.md:**
- Use single shared observer (not one per element) to avoid memory leaks
- Always call observer.unobserve() after animation completes
- Use transform/opacity only (GPU-accelerated, no layout thrashing)
- Threshold 0.15 (animations trigger when 15% visible, not 100%)
- Duration 600ms ease-out per requirements
- MUST respect prefers-reduced-motion (accessibility requirement)
  </action>
  <verify>
1. Open index.html in browser (if exists) or create minimal test HTML with sections
2. Open Chrome DevTools Performance tab, scroll through page
3. Verify no red bars (long tasks), frame rate 60 FPS on desktop
4. Open DevTools Memory tab, scroll up/down 10 times, verify memory stable (no growing heap)
5. Test prefers-reduced-motion: DevTools → Rendering → Emulate CSS prefers-reduced-motion: reduce, verify animations disabled
6. Check that sections fade in as they enter viewport, cards appear with stagger effect
  </verify>
  <done>
- All content sections have .animate-on-scroll class and fade in on scroll
- Card grids use staggered cascade with 100-150ms delays between items
- Single IntersectionObserver instance manages all elements (check with browser DevTools)
- observer.unobserve() called after each animation (no memory leaks)
- Animations respect prefers-reduced-motion media query
- Performance: 60 FPS scroll on desktop, no layout thrashing warnings
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement navbar scroll transitions and active section highlighting</name>
  <files>index.html</files>
  <action>
Add navbar scroll behavior to index.html:

**CSS (in existing `<style>` tag):**
1. Update navbar default state: background transparent, backdrop-filter none
2. Create `.navbar-scrolled` class: background rgba(0,0,0,0.8), backdrop-filter blur(10px), transition 300ms ease-out
3. Update navbar link default state: opacity 0.7
4. Create `.nav-link-active` class for active section: opacity 1, border-bottom with accent color, transition 200ms
5. Ensure navbar has will-change: background-color, backdrop-filter for smooth GPU acceleration

**JavaScript (in existing `<script>` tag):**
1. Add scroll event listener to window with passive: true for better performance
2. In scroll handler: get current scrollY position
3. Toggle `.navbar-scrolled` class on navbar when scrollY > window.innerHeight (past hero section)
4. Implement active section detection:
   - Query all section elements
   - For each section, get offsetTop and offsetHeight
   - Find section whose range contains (scrollY + navbar height + 100px offset)
   - Remove `.nav-link-active` from all nav links
   - Add `.nav-link-active` to corresponding nav link for current section
5. Throttle scroll handler to max 60fps using requestAnimationFrame (prevents jank)

**Example throttled scroll handler pattern:**
```javascript
let scrollTicking = false;
window.addEventListener('scroll', () => {
  if (!scrollTicking) {
    requestAnimationFrame(() => {
      // Navbar transition logic
      // Active section logic
      scrollTicking = false;
    });
    scrollTicking = true;
  }
}, { passive: true });
```

**Critical constraints:**
- Use passive scroll listener (performance)
- Use requestAnimationFrame throttling (no layout thrashing)
- Transition only background-color and backdrop-filter (GPU-accelerated)
- Do NOT read layout properties (offsetTop) then write styles in same frame
  </action>
  <verify>
1. Open index.html in browser, scroll from top
2. Verify navbar is transparent at hero, transitions to opaque with blur after scrolling past hero
3. Verify transition is smooth (300ms), no jank
4. Scroll through all sections, verify corresponding nav link highlights as each section enters viewport
5. Open DevTools Performance tab, record scroll session, verify no forced reflows or layout thrashing (no red bars)
6. Test on mobile viewport (DevTools device emulation), verify smooth performance
  </verify>
  <done>
- Navbar transitions from transparent to opaque background with blur on scroll past hero
- Transition is smooth 300ms with no visible jank
- Active section is highlighted in navbar based on scroll position
- Scroll handler is throttled with requestAnimationFrame (no performance issues)
- No forced layout recalculations (verified in DevTools Performance tab)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete scroll animation system with:
- Intersection Observer managing all scroll-triggered fade-in animations
- Staggered cascade for card grids (100-150ms delays)
- Navbar scroll transitions (transparent to opaque with blur)
- Active section highlighting in navbar
- prefers-reduced-motion support
  </what-built>
  <how-to-verify>
1. Open index.html in browser
2. Scroll slowly from top to bottom:
   - Verify all sections fade in smoothly as they enter viewport
   - Verify card grids appear with staggered cascade effect
   - Verify navbar transitions from transparent to opaque after hero
   - Verify active nav link highlights correctly for each section
3. Test performance:
   - Open Chrome DevTools → Performance tab
   - Record while scrolling up and down entire page
   - Verify frame rate stays at 60 FPS (desktop) or 30+ FPS (mobile)
   - Verify no red bars (long tasks) or layout thrashing warnings
4. Test accessibility:
   - Open DevTools → Rendering → Emulate CSS prefers-reduced-motion: reduce
   - Refresh page and scroll
   - Verify animations are disabled (sections appear immediately, no transitions)
5. Test memory:
   - Open DevTools → Memory → Take heap snapshot
   - Scroll up and down 10 times
   - Take another heap snapshot
   - Verify memory usage is stable (no significant growth indicating leaks)

Expected behavior:
- Smooth 600ms fade-in animations on scroll
- Navbar smoothly transitions to opaque background
- Active section always highlighted correctly
- 60 FPS on desktop, 30+ FPS on mobile
- Animations respect reduced motion preference
- No memory leaks
  </how-to-verify>
  <resume-signal>
Type "approved" if animations perform smoothly and accessibility works correctly, or describe any issues (jank, wrong timing, missing animations, performance problems).
  </resume-signal>
</task>

</tasks>

<verification>
**Overall Phase Checks:**

1. **Animation System:**
   - Single shared IntersectionObserver instance (check via DevTools)
   - All sections with .animate-on-scroll fade in on scroll
   - Card grids use staggered cascade (100-150ms delay)
   - Badges/icons use scale-in animation

2. **Navbar Behavior:**
   - Transparent at hero, opaque with blur after scroll
   - Active section highlighted in navbar
   - Smooth transitions (no jank)

3. **Performance:**
   - Lighthouse Performance > 90
   - 60 FPS on desktop during scroll
   - 30+ FPS on mobile during scroll
   - No layout thrashing (verified in DevTools Performance)
   - Memory stable (no leaks from Intersection Observer)

4. **Accessibility:**
   - prefers-reduced-motion disables all animations
   - Keyboard navigation works
   - ARIA labels present (verified)

5. **Requirements Coverage:**
   - ANIM-01: Section scroll animations ✓
   - ANIM-02: Card stagger animations ✓
   - ANIM-03: Badge/icon scale-in ✓
   - ANIM-06: Single shared Intersection Observer ✓
   - ANIM-07: prefers-reduced-motion support ✓
   - NAV-02: Navbar scroll transition ✓
   - NAV-03: Active section highlighting ✓
</verification>

<success_criteria>
**Measurable Completion:**

1. User scrolls from hero to footer → all sections fade in with translateY animation at 15% viewport threshold
2. User scrolls past hero → navbar transitions from transparent to opaque background with blur effect within 300ms
3. User scrolls through sections → active nav link highlights correctly for current section
4. DevTools Performance recording shows 60 FPS frame rate during scroll, no red bars, no forced reflows
5. DevTools Memory profiling shows stable heap after 10 scroll cycles (no Intersection Observer leaks)
6. prefers-reduced-motion: reduce setting disables all animations (sections appear immediately)
7. Card grids display staggered cascade with 100-150ms delays between items
8. Chrome Lighthouse audit shows Performance score > 90
</success_criteria>

<output>
After completion, create `.planning/phases/06-animations-interactivity/06-01-SUMMARY.md`
</output>
